<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Mapbox Exercise</title>
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet'/>
</head>
<body>
	<div id='map' style='width: 100%; height: 600px;'></div>
	<script>
		"use strict";
		mapboxgl.accessToken = 'pk.eyJ1IjoianNvbGV5bWFuemFkZWgiLCJhIjoiY2t5c3c4bTgyMDFiczJucW56c2ZoanZsbSJ9.PlX8l7UHAOw4tYWWEIBB6w';
		const map = new mapboxgl.Map({
			container: 'map', // container ID
			style: 'mapbox://styles/mapbox/streets-v11', // style URL
			center: [-74.5, 40], // starting position [lng, lat]
			zoom: 13 // starting zoom
		});

		function geocode(search, token) {
			let baseUrl = 'https://api.mapbox.com';
			let endPoint = '/geocoding/v5/mapbox.places/';
			return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
				.then(function (res) {
					return res.json();
					// to get all the data from the request, comment out the following three lines...
				}).then(function (data) {
					return data.features[0].center;
				});
		}

		geocode("San Antonio", mapboxgl.accessToken).then(function (result) {
			map.setCenter(result);
		});
		let favoriteRestaurants = [
			{
				name: "McDonald's",
				type: "Fast Food",
				address: "101 Alamo Plaza, San Antonio, TX 78205",
				hours: "0700 - 0000",
				phone: "+1 (210) 226-3800"
			}, {
				name: "McDonald's",
				type: "Fast Food",
				address: "703 W Houston St, San Antonio, TX 78207",
				hours: "Open 24 hours",
				phone: "+1 (210) 271-3565"
			}, {
				name: "McDonald's",
				type: "Fast Food",
				address: "721 San Pedro Ave, San Antonio, TX 78212",
				hours: "Open 24 hours",
				phone: "+1 (210) 227-5007"
			}
		]
		favoriteRestaurants.forEach(function (restaurant) {
			geocode(restaurant.address, mapboxgl.accessToken).then(function (result) {
				let marker = new mapboxgl.Marker().setLngLat(result).addTo(map);
				let popup = new mapboxgl.Popup().setHTML("<dl><dt><h3>" + restaurant.name + "</h3></dt><dd>" + restaurant.type + "</dd><dt>Address</dt><dd>" + restaurant.address + "</dd><dt>Hours</dt><dd>" + restaurant.hours + "</dd><dt>Phone</dt><dd>" + restaurant.phone + "</dd></dl>");
				marker.setPopup(popup);
			});
		});
	</script>
</body>
</html>